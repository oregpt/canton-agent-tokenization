# Debug Canton configuration with alternative Supabase connection

canton {
  features {
    enable-testing-commands = yes
  }

  participants {
    participant1 {
      storage {
        type = postgres
        config {
          # Alternative Supabase connection format
          url = "jdbc:postgresql://db.ovemmdtqavjkyuvikfqj.supabase.co:5432/postgres?sslmode=require&user=postgres&password=${SUPABASE_DB_PASSWORD}"

          # Reduced connection pool for testing
          numThreads = 2
          maxConnections = 4
          minConnections = 1

          # Extended timeouts for network issues
          connectionTimeout = "60s"
        }
      }

      admin-api {
        address = "0.0.0.0"
        port = 5012
      }

      ledger-api {
        address = "0.0.0.0"
        port = 5011
      }
    }
  }

  domains {
    local {
      storage {
        type = postgres
        config {
          # Different database name to avoid conflicts
          url = "jdbc:postgresql://db.ovemmdtqavjkyuvikfqj.supabase.co:5432/postgres?sslmode=require&user=postgres&password=${SUPABASE_DB_PASSWORD}&currentSchema=domain_local"

          numThreads = 2
          maxConnections = 2
          minConnections = 1
          connectionTimeout = "60s"
        }
      }

      public-api {
        address = "0.0.0.0"
        port = 5018
      }

      admin-api {
        address = "0.0.0.0"
        port = 5019
      }
    }
  }
}

# JSON API Configuration
json-api {
  http-port = 7575
  ledger-host = "localhost"
  ledger-port = 5011
  allow-insecure-tokens = true
  http-address = "0.0.0.0"
}