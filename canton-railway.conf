# Canton configuration for Railway's internal PostgreSQL

canton {
  features {
    enable-testing-commands = yes
  }

  participants {
    participant1 {
      storage {
        type = postgres
        config {
          # Railway automatically provides DATABASE_URL
          url = "${DATABASE_URL}"

          # Connection pool settings for Railway
          numThreads = 4
          maxConnections = 8
          minConnections = 2
          connectionTimeout = "30s"
        }
      }

      admin-api {
        address = "0.0.0.0"
        port = 5012
      }

      ledger-api {
        address = "0.0.0.0"
        port = 5011
      }
    }
  }

  domains {
    local {
      storage {
        type = postgres
        config {
          # Use same DATABASE_URL but different schema
          url = "${DATABASE_URL}?currentSchema=domain_local"

          numThreads = 2
          maxConnections = 4
          minConnections = 1
          connectionTimeout = "30s"
        }
      }

      public-api {
        address = "0.0.0.0"
        port = 5018
      }

      admin-api {
        address = "0.0.0.0"
        port = 5019
      }
    }
  }
}

# JSON API Configuration
json-api {
  http-port = ${?PORT}
  ledger-host = "localhost"
  ledger-port = 5011
  allow-insecure-tokens = true
  http-address = "0.0.0.0"
}