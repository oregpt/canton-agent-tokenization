# Canton configuration for Render cloud deployment
# Uses environment variables for database connection

canton {
  features {
    enable-testing-commands = no # Disabled for production
  }

  participants {
    participant1 {
      storage {
        type = postgres
        config {
          host = ${?DATABASE_HOST}
          port = 5432
          database = ${?DATABASE_NAME}
          user = ${?DATABASE_USER}
          password = ${?DATABASE_PASSWORD}
          max-connections = 10
          min-connections = 2
          # SSL required for Render PostgreSQL
          properties {
            ssl = true
            sslmode = "require"
          }
        }
      }

      admin-api {
        address = "0.0.0.0"
        port = 5012
      }

      ledger-api {
        address = "0.0.0.0"
        port = 5011
      }

      parameters {
        ledger-api-server-parameters {
          enable-daml-lf-dev-version-support = true
        }
      }
    }
  }

  domains {
    local {
      storage {
        type = postgres
        config {
          host = ${?DATABASE_HOST}
          port = 5432
          database = ${?DATABASE_NAME}
          user = ${?DATABASE_USER}
          password = ${?DATABASE_PASSWORD}
          max-connections = 10
          min-connections = 2
          # SSL required for Render PostgreSQL
          properties {
            ssl = true
            sslmode = "require"
          }
        }
      }

      public-api {
        address = "0.0.0.0"
        port = 5018
      }

      admin-api {
        address = "0.0.0.0"
        port = 5019
      }
    }
  }

  # JSON API Configuration
  parameters {
    json-api {
      address = "0.0.0.0"
      http-port = ${?PORT}
      # CORS configuration for web app access
      cors {
        allow-origin = ${?CORS_ORIGIN}
      }
      # Disable auth for development - enable for production
      auth-services = []
    }
  }
}