# Canton configuration with Supabase PostgreSQL for Railway deployment

canton {
  features {
    enable-testing-commands = yes
  }

  participants {
    participant1 {
      storage {
        type = postgres
        config {
          # Supabase JDBC connection
          url = "jdbc:postgresql://db.ovemmdtqavjkyuvikfqj.supabase.co:5432/postgres?sslmode=require"
          user = "postgres"
          password = "${SUPABASE_DB_PASSWORD}"

          # Connection pool settings
          numThreads = 8
          maxConnections = 8
          minConnections = 2
        }
      }

      admin-api {
        address = "0.0.0.0"  # Accept connections from Railway
        port = 5012
      }

      ledger-api {
        address = "0.0.0.0"  # Accept connections from Railway
        port = 5011
      }

      # Parameters section removed due to compatibility
    }
  }

  domains {
    local {
      storage {
        type = postgres
        config {
          # Supabase JDBC connection with different schema for domain
          url = "jdbc:postgresql://db.ovemmdtqavjkyuvikfqj.supabase.co:5432/postgres?sslmode=require&currentSchema=domain_local"
          user = "postgres"
          password = "${SUPABASE_DB_PASSWORD}"

          # Connection pool settings
          numThreads = 4
          maxConnections = 4
          minConnections = 1
        }
      }

      public-api {
        address = "0.0.0.0"  # Accept connections from Railway
        port = 5018
      }

      admin-api {
        address = "0.0.0.0"  # Accept connections from Railway
        port = 5019
      }
    }
  }
}

# JSON API Configuration for Railway
json-api {
  http-port = 7575
  ledger-host = "localhost"
  ledger-port = 5011

  # Allow CORS for web frontends
  allow-insecure-tokens = true

  # Bind to all interfaces for Railway
  http-address = "0.0.0.0"
}